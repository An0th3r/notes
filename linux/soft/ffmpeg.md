#ffmpeg


测试系统环境：ubuntu6.06

首先当然是需要安装ffmpeg软件包，可以直接从源中进行安装！但我安装后并不能成功执行后面所需要执行的转换命令，所以我只能重新从源码编译安装ffmpeg：

(1)下载ffmpeg源码包，注意版本不能太高，应该与直接从源中安装的版本大抵相当最好；我刚开始下的版本比较高，编译时提示说有一个编译选项找不 到，我到网上也没搜出什么结果，所以只能又降低了版本，最后使用的是ffmpeg-0.4.9-p20050906.tbz！

(2)参考文档 https://wiki.ubuntu.com/ffmpeg 进行编译安装，在编译的时候可能还会有很多错误提示，但多半是由于某些头文件找不到所致，所以直接从源中安装提供这些头文件的包即可（技巧提示，可以在源中直接搜索头文件*.h去掉后缀.h的名称*即可，一般需要安装其对应的*-dev包）！

安装完毕之后就可以进行转码操作了：

(1) 对于普通的avi视频文件，可以直接使用命令：
ffmpeg -y -i "tt.avi" -vcodec xvid -s 400x240 -r 29.97 -b 1500 -acodec aac -ac 2 -ar 48000 -ab 128 -vol 200 -f mp4&<60;&<60;"tt.mp4"

参数解释如下：

-y 覆盖输出文件，即如果tt.mp4文件已经存在的话，不经提示就覆盖掉了
-i "tt.avi" 输入文件名，可以自己修改路径和名字
-vcodec xvid 使用XVID编码压缩视频，不能改的
-s 400x240 输出的分辨率，注意片源一定要是16:9的不然会变形
-r 29.97 帧数 (一般用25就可以了)
-b 1500 视频数据流量，用-b xxx表示使用固定码率，数字可更改；还可以用动态码率如：-qscale 4和-qscale 6，4的质量比6高（一般用800就可以了，否则文件会很大）
-acodec aac 音频编码用AAC
-ac 2 声道数1或2
-ar 48000 声音的采样频率
-ab 128 音频数据流量，一般选择32、64、96、128
-vol 200 200%的音量，可更改（如果源文件声音很小，可以提升10到20倍(1000%~2000%)，我试过，效果还行！但不能太大，200000%我也试验过，但嘈杂声太大了）
-f mp4 输出mp4格式
"tt.mp4" 输出文件名，也可以修改路径和名称

至于这些参数的值是如何得到的，那就得看你的播放设备(mp4，psp，手机等等)了！刚买播放设备的时候，里面肯定会预置有一些视频文件，通过查看这些 预置文件即可得到你的播放设备所支持视频的各项参数！最简单的方法，可以到windows下用暴风影音或KMP播放器打开一个预置视频文件（KMP列出的 比暴风影音还要详细），然后通过查看属性就能得到所有你需要的参数了！

(2) 对于wmv9，rm，rmvb等视频格式，ffmpeg还无法解析，但可以通过两次转换达到目的：
先用mencoder将其转换成avi格式：
mencoder tt.rmvb -ovc lavc -oac mp3lame -o tt.avi
然后再利用(1)中的命令对该avi文件进行转换即可！

参数说明：

tt.rmvb 输入文件（可自己修改路径及名称）
-ovc lavc 视频编码格式（mp4视频）
-oac mp3lame 音频编码格式（mp3音频）
-o tt.avi 输出文件（可自己修改路径及名称）

mencoder是与mplayer一起安装的，安装了mplayer，系统肯定就会有mencoder！ mencoder与ffmpeg好像都有windows版的！
mencoder的功能也很强大，至于为什么不用mencoder一次性转换到位？这个问题我也还在抽时间研究，因为它的参数使用更加复杂，我现在还没试验成功！

至于其它的视频文件格式，我用的不多，所以也没测试过，不过应该都能利用(1)中的命令进行搞定！

就这样，你喜欢的电影就能与你形影相随了！

补充一点：

我个人比较喜欢单个的视频文件，所以如果一个视频文件被分成了两个，也可以通过mencoder对其进行合并(好像仅支持avi视频格式的合并)！

假如有两个rmvb文件cd1.rmvb和cd2.rmvb，反正也是分别需要转换成avi格式的，那么转换到avi之后，就可以通过命令：
mencoder t1.avi t2.avi -ovc copy -oac copy -o all.avi
对分割的文件进行合并，合并完之后，再将其转换成mp4即可！主要是看个人的爱好了！

参数说明：

t1.avi t2.avi 输入文件（可自己修改路径及名称，还可以更多，空格分开，注意顺序，还有这些输入文件的码流也需要一致）
-ovc copy 表示视频编码格式不变（因为是合并而不是转换，所以没必要变）
-oac copy 表示音频编码格式不变（同上）
-o tt.avi 输出文件（可自己修改路径及名称，按输入文件的顺序进行连接的）

------------------

ffmpeg -i F:\01.wmv -ab 56 -ar 22050 -b 500 -r 15 -s 320x240 f:\test.flv
使用-ss参数 作用（time_off set the start time offset），可以从指定时间点开始转换任务。如:
转换文件格式的同时抓缩微图：
ffmpeg -i "test.avi" -y -f image2 -ss 8 -t 0.001 -s 350x240 'test.jpg'
对已有flv抓图：
ffmpeg -i "test.flv" -y -f image2 -ss 8 -t 0.001 -s 350x240 'test.jpg'
-ss后跟的时间单位为秒
Ffmpeg转换命令
ffmpeg -y -i test.mpeg -bitexact -vcodec h263 -b 128 -r 15 -s 176x144 -acodec aac -ac 2 -ar 22500
-ab 24 -f 3gp test.3gp
或者
ffmpeg -y -i test.mpeg -ac 1 -acodec amr_nb -ar 8000 -s 176x144 -b 128 -r 15 test.3gp
 
ffmpeg参数设定解说
-bitexact 使用标准比特率
-vcodec xvid 使用xvid压缩
-s 320x240 指定分辨率
-r 29.97 桢速率（可以改，确认非标准桢率会导致音画不同步，所以只能设定为15或者29.97）
画面部分，选其一
-b <比特率> 指定压缩比特率，似乎ffmpeg是自动VBR的，指定了就大概是平均比特率，比如768，1500这样的
就是原来默认项目中有的
-qscale <数值> 以<数值>质量为基础的VBR，取值0.01-255，约小质量越好
-qmin <数值> 设定最小质量，与-qmax（设定最大质量）共用，比如-qmin 10 -qmax 31
-sameq 使用和源同样的质量
声音部分
-acodec aac 设定声音编码
-ac <数值> 设定声道数，1就是单声道，2就是立体声，转换单声道的TVrip可以用1（节省一半容量），高品质
的DVDrip就可以用2
-ar <采样率> 设定声音采样率，PSP只认24000
-ab <比特率> 设定声音比特率，前面-ac设为立体声时要以一半比特率来设置，比如192kbps的就设成96，转换
君默认比特率都较小，要听到较高品质声音的话建议设到160kbps（80）以上
-vol <百分比> 设定音量，某些DVDrip的AC3轨音量极小，转换时可以用这个提高音量，比如200就是原来的2倍
这样，要得到一个高画质音质低容量的MP4的话，首先画面最好不要用固定比特率，而用VBR参数让程序自己去
判断，而音质参数可以在原来的基础上提升一点，听起来要舒服很多，也不会太大（看情况调整
 
 
例子：ffmpeg -y -i "1.avi" -title "Test" -vcodec xvid -s 368x208 -r 29.97 -b 1500 -acodec aac -ac 2 -ar 24000 -ab 128 -vol 200 -f psp -muxvb 768 "1.***"

解释：以上命令可以在Dos命令行中输入，也可以创建到批处理文件中运行。不过，前提是：要在ffmpeg所在的目录中执行（转换君所在目录下面的cores子目录）。
参数：
-y（覆盖输出文件，即如果1.***文件已经存在的话，不经提示就覆盖掉了）
-i "1.avi"（输入文件是和ffmpeg在同一目录下的1.avi文件，可以自己加路径，改名字）
-title "Test"（在PSP中显示的影片的标题）
-vcodec xvid（使用XVID编码压缩视频，不能改的）
-s 368x208（输出的分辨率为368x208，注意片源一定要是16:9的不然会变形）
-r 29.97（帧数，一般就用这个吧）
-b 1500（视频数据流量，用-b xxxx的指令则使用固定码率，数字随便改，1500以上没效果；还可以用动态码率如：-qscale 4和-qscale 6，4的质量比6高）
-acodec aac（音频编码用AAC）
-ac 2（声道数1或2）
-ar 24000（声音的采样频率，好像PSP只能支持24000Hz）
-ab 128（音频数据流量，一般选择32、64、96、128）
-vol 200（200%的音量，自己改）
-f psp（输出psp专用格式）
-muxvb 768（好像是给PSP机器识别的码率，一般选择384、512和768，我改成1500，PSP就说文件损坏了）
"1.***"（输出文件名，也可以加路径改文件名） 
