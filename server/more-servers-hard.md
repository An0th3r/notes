# 多服务器高性能方案

## 硬件

单个主机

* 处理器(cpu): 2/4/8 2.4G
* 内存(mem): 2/4/8 G 
* 硬盘(disk): 80GB 
* 系统(os): CentOS 6.4
* 网卡: 单/双网卡

使用多主机和站点分离时，根据服务器功能不同来配置选购。

站点服务器和发布服务器 使用高cpu，高内存，低容量硬盘, 即高性能低容量主机。

备份服务器使用低性能高容量主机。使用大量图片或者视频时可挂载外部硬盘。

## 带宽

站点流量决定带宽的选择。

参考[双线提速方案](dns-doublet.md)

## 单主机

如果站点流量低，媒体文件较少，使用中等性能主机即可，通过nginx+php-fpm性能优化也能够有效的利用主机资源保证站点的通畅性。

## 多服务器

当站点具有以下特点时，建议使用多主机来实现数据的均衡负载

* 高流量
* 高并发(访问率)
* 数据量较大
* 媒体文件多

利用多服务器来实现，多站点,多域名负载均衡，分散数据压力。有效数据备份保证站点数据的安全性，利用防止文件篡改系统来保证服务器文件的安全性能。

## 服务器的优化

**nginx**

* 高并发优化最大化利用cpu性能
* 最大连接数
* 上传限制
* ...

**php-fpm** 

* 文件执行优化
* 缓存优化,减少文件执行率
* 进程优化
* 重启提高新能,提高用户访问效率
* ...

**mysql**

* 利用多台服务器,主从服务器均衡流量，增强站点的承受压力。
* ...

## 多域名

* 站点(可配置多服务器使用代理来实现均衡服务器)
* 静态文件js/css/img/, 上传的文件 

## 备份

为保证数据的安全性，定期备份站点和数据。依照备份周期，和备份后的文件大小以及数据增长的预测，和数据保存的有效时间来计算所需硬盘空间大小。此时必须保证足够大小的硬盘来支撑备份。

案例：

* 数据每30分钟备份，保存周期两个月，可以有效的回滚数据
* 站点文件每周备份，保存一个月。
* 用户上传文件的同步备份。 

## 防篡改

由一台发布服务器，发布站点文件到各个服务器中,来达到各个服务器中中的站点文件的安全和一致性。


## 小结

根据站点自身特点来选在服务器硬件配置方案。

* 流量顶峰
* 带宽
* 用户量
* 功能性能要求
